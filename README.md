A bad implementation of a finite state machine with (this is the bad part) substates.
Do yourself a favor, don't use this code. Can't hurt to understand it though which is why I wrote it.
